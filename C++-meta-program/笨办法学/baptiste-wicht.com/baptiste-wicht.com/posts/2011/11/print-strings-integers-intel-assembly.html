<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How to print strings and integers in Intel Assembly on Linux ? | Blog blog("Baptiste Wicht");</title>
<script src="/cdn-cgi/apps/head/98vpnawSZZMscPn4oDND-ZgswjM.js"></script><link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/posts/2011/11/print-strings-integers-intel-assembly.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="eddi-compiler-0-6-0-arrays.html" title="EDDI Compiler 0.6.0 : Arrays" type="text/html">
<link rel="next" href="linux-mint-12-lisa-released.html" title="Linux Mint 12 (Lisa) released!" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="How to print strings and integers in Intel Assembly on Linux ?">
<meta property="og:url" content="http://baptiste-wicht.com/posts/2011/11/print-strings-integers-intel-assembly.html">
<meta property="og:description" content="In this post, we'll learn how to print strings and integers to the console on Linux using Intel Assembly. In this post, I'll use the AT&amp;T notation, because it's the notation used in EDDI. 
In EDDI, I ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2011-11-23T09:11:59+01:00">
<meta property="article:tag" content="Assembly">
<meta property="article:tag" content="EDDI">
<meta property="article:tag" content="Intel">
<meta property="article:tag" content="Linux">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
<div class="container-fluid">

<div class="row">
<div class="col-sm-3 col-lg-2">
<nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="http://baptiste-wicht.com/">
<span id="blog-title">Blog blog("Baptiste Wicht");</span>
</a>
</div>

<div class="collapse navbar-collapse navbar-ex1-collapse">
<ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
</li>
<li>
<a href="../../../stories/publications.html">Publications</a>
</li>
<li>
<a href="../../../stories/projects.html">Projects</a>
</li>
<li>
<a href="../../../categories/index.html">Tags</a>
</li>
<li>
<a href="../../../archive.html">Archives</a>
</li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>
</li>
<li class="navbar-content">
<h3>Related posts</h3>
</li>
<li><a href="dynamic-memory-allocation-intel-assembly-linux.html">Dynamic memory allocation in Intel Assembly on Linux</a></li>
<li><a href="../../2012/03/introduction-64-bit-intel-assembly-language-programming-linux-book-review.html">Introduction to 64 Bit Intel Assembly Language Programming for Linux - Book Review</a></li>
<li><a href="../../2012/03/eddic-0-9-floating-point-support.html">EDDIC 0.9 - Floating point support</a></li>
<li><a href="../07/eddi-0-4-native-compilation-swap.html">EDDI 0.4 : Native compilation and swap operator</a></li>
<li><a href="../../2012/02/assembly-language-step-by-step-book-review.html">Assembly Language Step By Step, Programming with Linux - Book Review</a></li>
<li><a href="eddic-0-5-1-better-assembly-generation-and-faster-parsing.html">eddic 0.5.1 : Better assembly generation and faster parsing</a></li>
<li class="navbar-block">
<li class="wicht-navbar-right">
<a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
<img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
</li>
<li class="wicht-navbar-right">
<a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
<img src="../../../assets/img/google_plus.png" alt="Follow +BaptisteWicht on Google+"></a>
</li>
</ul>
</div>

</nav>
</div> 
<div class="col-sm-9 col-lg-10">
<div id="content"></div>
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">How to print strings and integers in Intel Assembly on Linux ?</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">
Baptiste Wicht
</span></p>
<p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2011-11-23T09:11:59+01:00" itemprop="datePublished" title="2011-11-23 09:11">2011-11-23 09:11</time></a></p>
<p class="commentline">
<a href="print-strings-integers-intel-assembly.html#disqus_thread" data-disqus-identifier="cache/posts/2011/11/print-strings-integers-intel-assembly.html">Comments</a>
</p>
<p class="sourceline"><a href="print-strings-integers-intel-assembly.wp" class="sourcelink">Source</a></p>
</div>
</header><div class="e-content entry-content" itemprop="articleBody text">
<div>
<p>In this post, we'll learn how to print strings and integers to the console on Linux using Intel Assembly. In this post, I'll use the AT&amp;T notation, because it's the notation used in EDDI. </p>
<p>In EDDI, I have to print strings and numbers to the console, as this is not an easy exercise, I wanted to share my experience here. </p>
<p>On Linux, the only way to print something on the console is to use a system call. For that, we have to use the 0x08 interrupt code. </p>
<h4>Declare strings</h4>
<p>First, we'll see how to declare strings in an Intel Assembly file. You can use the <strong>.string</strong> instruction to achieve that : </p>
<pre class="code literal-block"><span></span><span class="nl">StringToPrint:</span>
<span class="na">.string</span> <span class="s">"Hello"</span>
</pre>
<h4>Print strings</h4>

<p>Then, to print, we will call the <em>sys_write</em> system call : </p>
<pre class="code literal-block"><span></span><span class="nf">movl</span> <span class="no">$4</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">movl</span> <span class="no">$1</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">movl</span> <span class="no">$StringToPrint</span><span class="p">,</span> <span class="nv">%ecx</span>
<span class="nf">movl</span> <span class="no">$5</span><span class="p">,</span> <span class="nv">%edx</span>
<span class="nf">int</span> <span class="no">$0x80</span>
</pre>
<p>The value in <strong>%eax</strong> (4) indicates the system call we need (<em>sys_write</em>). The 1 in <strong>%ebx</strong> indicates that we want to write in the console. Finally the two last parameters indicates the string to print and the size of the string. In Intel assembly, the <strong>int</strong> instruction launch an interrupt and the 0x80 in the interrupt table is set to the system call in the Linux Kernel. </p>
<p>As you can see, this code does use 4 registers and does not save any of them. Ideally, you will save the registers before and restore them. It depends on when you use this routine. </p>
<h4>Print integers</h4>
<p>Writing an integer is a bit more complicated. If you have the integer in the string, there is no problem, but if you have only a long on your assembly, you'll have to convert the int into a string to print it. We will convert the integer char after char and use the stack as storage for our string. Then every char will be printed to the console using the same system as before. </p>
<p>So let's say we have our number in the <strong>%eax</strong> register : </p>
<pre class="code literal-block"><span></span><span class="nf">movl</span> <span class="no">$9234</span><span class="p">,</span> <span class="nv">%eax</span>
</pre>
<p>So let's take a look at the code : </p>
<pre class="code literal-block"><span></span><span class="nf">xorl</span> <span class="nv">%esi</span><span class="p">,</span> <span class="nv">%esi</span>

<span class="nl">loop:</span>
<span class="nf">movl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%edx</span>
<span class="nf">movl</span> <span class="no">$10</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">divl</span> <span class="nv">%ebx</span>
<span class="nf">addl</span> <span class="no">$48</span><span class="p">,</span> <span class="nv">%edx</span>
<span class="nf">pushl</span> <span class="nv">%edx</span>
<span class="nf">incl</span> <span class="nv">%esi</span>
<span class="nf">cmpl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">jz</span>   <span class="no">next</span>
<span class="nf">jmp</span> <span class="no">loop</span>

<span class="nl">next:</span>
<span class="nf">cmpl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%esi</span>
<span class="nf">jz</span>   <span class="no">exit</span>
<span class="nf">decl</span> <span class="nv">%esi</span>
<span class="nf">movl</span> <span class="no">$4</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">movl</span> <span class="nv">%esp</span><span class="p">,</span> <span class="nv">%ecx</span>
<span class="nf">movl</span> <span class="no">$1</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">movl</span> <span class="no">$1</span><span class="p">,</span> <span class="nv">%edx</span>
<span class="nf">int</span>  <span class="no">$0x80</span>
<span class="nf">addl</span> <span class="no">$4</span><span class="p">,</span> <span class="nv">%esp</span>
<span class="nf">jmp</span>  <span class="no">next</span>

<span class="nl">exit:</span>
</pre>
<p>The first part of the code consists in dividing the value by 10 until we reach zero. The remainder of the division is pushed onto the stack. For example, for our number, after this part, we'll have 4-3-2-9 on the stack. The order is reversed, which is logic because we stack the remainders from the right. During this phase, we count the number of elements using the <strong>%esi</strong> register. </p>
<p>Once this is done, we print each characters one by one starting with the last that has been pushed. Here we decrement the counter for each char and we use the <strong>sys_write</strong> call with <strong>%esp</strong> as the address of the string of one character. After each character, we incremetn the <strong>%esp</strong> to cancel the push that we used. </p>
<p>We have to do this in two phases in order to get the characters in the good order and not in reverse order. </p>
<h4>Handle negative numbers</h4>
<p>As you may have noticed, we do not manage negative numbers in our code. They will be printed, but it will be positive number. Indeed, in Intel Assembly (and in processors in general), negative numbers are handled with two's complement. Handling negative numbers in our code is not a big deal. We can add this code at the beginning : </p>
<pre class="code literal-block"><span></span><span class="nf">cmpl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">jge</span> <span class="no">loop</span>
<span class="nf">neg</span> <span class="nv">%eax</span>
<span class="nf">pushl</span> <span class="nv">%eax</span>
<span class="c">; Print "-" </span>
<span class="nf">popl</span> <span class="nv">%eax</span>
</pre>
<p>First of all, we check if the number is smaller than 0, if it's not the case, we directly jump to the code we used before. If it's smaller, we negate the number and print a - before printing the real number. We have to save the <strong>%eax</strong> register before printing the - character because <strong>%eax</strong> is used for printing. </p>
<p>You'll now have a complete procedure to print an integer on the console in assembly. </p>
<p>I hope that this could be of some help for somebody.</p>
</div>
</div>
<aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/assembly.html" rel="tag">Assembly</a></li>
<li><a class="tag p-category" href="../../../categories/eddi.html" rel="tag">EDDI</a></li>
<li><a class="tag p-category" href="../../../categories/intel.html" rel="tag">Intel</a></li>
<li><a class="tag p-category" href="../../../categories/linux.html" rel="tag">Linux</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous">
<a href="eddi-compiler-0-6-0-arrays.html" rel="prev" title="EDDI Compiler 0.6.0 : Arrays">Previous post</a>
</li>
<li class="next">
<a href="linux-mint-12-lisa-released.html" rel="next" title="Linux Mint 12 (Lisa) released!">Next post</a>
</li>
</ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
<div id="disqus_thread"></div>
<script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2011/11/print-strings-integers-intel-assembly.html",
        disqus_title="How to print strings and integers in Intel Assembly on Linux ?",
        disqus_identifier="cache/posts/2011/11/print-strings-integers-intel-assembly.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
<a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>
</section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> 
</div>

</div>



<footer>
Contents Â© 2017 <a href="/cdn-cgi/l/email-protection#83e1e2f3f7eaf0f7e6f4eae0ebf7c3e4eee2eaefade0ecee">Baptiste Wicht</a> - Powered by <a href="http://getnikola.com" rel="nofollow">Nikola</a> - License:
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
<ul class="footer_inline_ul">
<li>
<a href="print-strings-integers-intel-assembly.wp" id="sourcelink">Source</a>
</li>
</ul></footer><script src="/cdn-cgi/scripts/78d64697/cloudflare-static/email-decode.min.js"></script><script src="../../../assets/js/all-nocdn.js"></script>
</body>
</html>
