<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How to profile your applications using the Linux perf tools | Blog blog("Baptiste Wicht");</title>
<script src="/cdn-cgi/apps/head/98vpnawSZZMscPn4oDND-ZgswjM.js"></script><link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/posts/2011/07/profile-applications-linux-perf-tools.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="eddi-0-3-branches-conditions.html" title="EDDI 0.3 - Branches and conditions if, else if, else" type="text/html">
<link rel="next" href="eddi-0-4-native-compilation-swap.html" title="EDDI 0.4 : Native compilation and swap operator" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="How to profile your applications using the Linux perf tools">
<meta property="og:url" content="http://baptiste-wicht.com/posts/2011/07/profile-applications-linux-perf-tools.html">
<meta property="og:description" content="When an application encounters some performance issues, we have to find the code that causes the problem to optimize only what really matters. 
To find the code we have to optimize, the profilers are ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2011-07-18T09:30:45+02:00">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Performances">
<meta property="article:tag" content="Tools">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
<div class="container-fluid">

<div class="row">
<div class="col-sm-3 col-lg-2">
<nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="http://baptiste-wicht.com/">
<span id="blog-title">Blog blog("Baptiste Wicht");</span>
</a>
</div>

<div class="collapse navbar-collapse navbar-ex1-collapse">
<ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
</li>
<li>
<a href="../../../stories/publications.html">Publications</a>
</li>
<li>
<a href="../../../stories/projects.html">Projects</a>
</li>
<li>
<a href="../../../categories/index.html">Tags</a>
</li>
<li>
<a href="../../../archive.html">Archives</a>
</li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>
</li>
<li class="navbar-content">
<h3>Related posts</h3>
</li>
<li><a href="../09/profile-c-application-with-callgrind-kcachegrind.html">How to profile C++ application with Callgrind / KCacheGrind</a></li>
<li><a href="../../2010/07/profile-applications-java-visualvm.html">Profile your applications with Java VisualVM</a></li>
<li><a href="../../2010/07/tip-profile-osgi-application-visualvm.html">Tip : Profile an OSGi application with VisualVM</a></li>
<li><a href="../../2010/07/tip-optimize-images-on-ubuntu-linux.html">Tip : Optimize images on Ubuntu Linux</a></li>
<li><a href="../../2010/07/discover-java-visualvm-1-3.html">Discover Java VisualVM 1.3</a></li>
<li><a href="../../2012/09/back-in-berkeley-california.html">Back in Berkeley, California</a></li>
<li class="navbar-block">
<li class="wicht-navbar-right">
<a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
<img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
</li>
<li class="wicht-navbar-right">
<a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
<img src="../../../assets/img/google_plus.png" alt="Follow +BaptisteWicht on Google+"></a>
</li>
</ul>
</div>

</nav>
</div> 
<div class="col-sm-9 col-lg-10">
<div id="content"></div>
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">How to profile your applications using the Linux perf tools</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">
Baptiste Wicht
</span></p>
<p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2011-07-18T09:30:45+02:00" itemprop="datePublished" title="2011-07-18 09:30">2011-07-18 09:30</time></a></p>
<p class="commentline">
<a href="profile-applications-linux-perf-tools.html#disqus_thread" data-disqus-identifier="cache/posts/2011/07/profile-applications-linux-perf-tools.html">Comments</a>
</p>
<p class="sourceline"><a href="profile-applications-linux-perf-tools.wp" class="sourcelink">Source</a></p>
</div>
</header><div class="e-content entry-content" itemprop="articleBody text">
<div>
<p>When an application encounters some performance issues, we have to find the code that causes the problem to optimize only what really matters. </p>
<p>To find the code we have to optimize, the profilers are really useful. In this post, we'll use the Linux perf tools to profile a simple C++ application. </p>
<p>The perf tools are integrated in the Linux kernel since the 2.6 version. The perf tools are based on the perf events subsystem. The perf profiler uses hardware counters to profile the application. The result of this profiler are really precise and because it is not doing instrumentation of the code, it is really fast. </p>

<h4>Installation</h4>
<p>First of all, if it is not already done, you have to install the perf tools on your computer. On Ubuntu, you can just use apt-get to install it : </p>
<pre>sudo apt-get install linux-tools</pre>
<p>On the other systems, just use your favorite package manager to install the perf tools. </p>
<h4>Usage</h4>
<p>To profile an application, you have to record information about an executation, for that, you just have to use perf record : </p>
<pre>perf record program [program_options]</pre>
<p>For example : </p>
<pre>perf record eddic assembly.eddi</pre>
<p>Once the execution is over, perf will gives you some information about the record, like: </p>
<pre>[ perf record: Woken up 44 times to write data ]

[ perf record: Captured and wrote 11.483 MB perf.data (~501721 samples) ]</pre>
<p>If you see that the size of the perf.data is really small, generally for small execution time, you can configure the event period in order to have more information with the --count=period option using a small period. I usually uses 1000, but it can be useful to use a smaller number when the application has a short execution time. </p>
<p>Then, to see the list of the most costly functions, you just have to use perf report : </p>
<pre>perf report</pre>
<p>It will display a list of the most costly functions ordered by cost. Here is an example taken from one of my C++ applications (the length of the function names is reduced to fit the screen) here : </p>
<pre># Events: 374K cycles
#
# Overhead         Command             Shared Object                                                                                                                               
# ........  ..............  ........................  ...............................................................
#
    87.58%        inlining  [vesafb]                  [k] 0xffffffff81100700
    83.27%         readelf  [vesafb]                  [k] 0xffffffff815c3930
    41.40%              sh  [vesafb]                  [k] 0xffffffff815c3930
    37.74%        inlining  libstdc++.so.6.0.14       [.] 0x653e0         
    12.49%         readelf  libc-2.13.so              [.] vfprintf
     5.37%        inlining  inlining                  [.] parseFunction(std::string, std::string, std::map
     5.20%         readelf  libc-2.13.so              [.] _IO_new_file_xsputn
     4.50%         readelf  readelf                   [.] 0x150e          
     4.10%        inlining  libc-2.13.so              [.] _int_malloc
     4.01%        inlining  libc-2.13.so              [.] memcpy
     3.80%         readelf  libc-2.13.so              [.] ___printf_chk
     2.58%        inlining  libc-2.13.so              [.] __malloc
     1.86%        inlining  libc-2.13.so              [.] _IO_fgets
     1.84%        inlining  inlining                  [.] parseExecutable(std::string, std::set
     1.83%         readelf  libc-2.13.so              [.] __strchrnul
     1.83%        inlining  libc-2.13.so              [.] _int_free
     1.77%        inlining  libc-2.13.so              [.] __strlen_sse42
     1.50%        inlining  libc-2.13.so              [.] cfree
     1.48%        inlining  libc-2.13.so              [.] __memchr
     1.23%        inlining  inlining                  [.] parseLibrary(std::string, std::se
     1.19%        inlining  libboost_graph.so.1.46.1  [.] char* std::string::_S_construct<char const>(char const*)
     1.17%         readelf  libc-2.13.so              [.] __dcigettext
     1.15%        inlining  libc-2.13.so              [.] _IO_getline_info_internal</char></pre>
<p>For every functions, you have the information about the cost of the function, the command used to launch it and the shared object in which the function is located. You can navigate through the list like in more utility. </p>
<p>This tool can be really useful to see which functions is interesting to optimize in order to increase the overall performance of the application. </p>
<p>For more information about the perf tools, you can read the <a href="https://perf.wiki.kernel.org/index.php/Main_Page" title="perf tools Wiki">perf wiki</a></p>
<p>In a future article, I will talk about another profiler, Callgrind.</p>
</div>
</div>
<aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/c%2B%2B.html" rel="tag">C++</a></li>
<li><a class="tag p-category" href="../../../categories/linux.html" rel="tag">Linux</a></li>
<li><a class="tag p-category" href="../../../categories/performances.html" rel="tag">Performances</a></li>
<li><a class="tag p-category" href="../../../categories/tools.html" rel="tag">Tools</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous">
<a href="eddi-0-3-branches-conditions.html" rel="prev" title="EDDI 0.3 - Branches and conditions if, else if, else">Previous post</a>
</li>
<li class="next">
<a href="eddi-0-4-native-compilation-swap.html" rel="next" title="EDDI 0.4 : Native compilation and swap operator">Next post</a>
</li>
</ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
<div id="disqus_thread"></div>
<script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2011/07/profile-applications-linux-perf-tools.html",
        disqus_title="How to profile your applications using the Linux perf tools",
        disqus_identifier="cache/posts/2011/07/profile-applications-linux-perf-tools.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
<a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>
</section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> 
</div>

</div>



<footer>
Contents Â© 2017 <a href="/cdn-cgi/l/email-protection#17757667637e646372607e747f6357707a767e7b3974787a">Baptiste Wicht</a> - Powered by <a href="http://getnikola.com" rel="nofollow">Nikola</a> - License:
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
<ul class="footer_inline_ul">
<li>
<a href="profile-applications-linux-perf-tools.wp" id="sourcelink">Source</a>
</li>
</ul></footer><script src="/cdn-cgi/scripts/78d64697/cloudflare-static/email-decode.min.js"></script><script src="../../../assets/js/all-nocdn.js"></script>
</body>
</html>
