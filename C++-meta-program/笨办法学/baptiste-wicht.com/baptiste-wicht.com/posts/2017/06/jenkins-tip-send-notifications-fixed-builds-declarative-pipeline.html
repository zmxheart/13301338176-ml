<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Short tip. How to send notifications on fixed builds in Jenkins declarative pipelines.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Jenkins Tip: Send notifications on fixed builds in declarative pipeline | Blog blog("Baptiste Wicht");</title>
<script src="/cdn-cgi/apps/head/98vpnawSZZMscPn4oDND-ZgswjM.js"></script><link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/posts/2017/06/jenkins-tip-send-notifications-fixed-builds-declarative-pipeline.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="jenkins-declarative-pipeline-and-awesome-github-integration.html" title="Jenkins Declarative Pipeline and Awesome Github Integration" type="text/html">
<link rel="next" href="../07/update-on-deep-learning-library-dll-dropout-batch-normalization-adaptive-learning-rates.html" title="Update on Deep Learning Library (DLL): Dropout, Batch Normalization, Adaptive Learning Rates, ..." type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="Jenkins Tip: Send notifications on fixed builds in declarative pipelin">
<meta property="og:url" content="http://baptiste-wicht.com/posts/2017/06/jenkins-tip-send-notifications-fixed-builds-declarative-pipeline.html">
<meta property="og:description" content="Short tip. How to send notifications on fixed builds in Jenkins declarative pipelines.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-06-07T09:52:57+02:00">
<meta property="article:tag" content="Continuous Integration">
<meta property="article:tag" content="Jenkins">
<meta property="article:tag" content="Tools">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
<div class="container-fluid">

<div class="row">
<div class="col-sm-3 col-lg-2">
<nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="http://baptiste-wicht.com/">
<span id="blog-title">Blog blog("Baptiste Wicht");</span>
</a>
</div>

<div class="collapse navbar-collapse navbar-ex1-collapse">
<ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
</li>
<li>
<a href="../../../stories/publications.html">Publications</a>
</li>
<li>
<a href="../../../stories/projects.html">Projects</a>
</li>
<li>
<a href="../../../categories/index.html">Tags</a>
</li>
<li>
<a href="../../../archive.html">Archives</a>
</li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>
</li>
<li class="navbar-content">
<h3>Related posts</h3>
</li>
<li><a href="jenkins-declarative-pipeline-and-awesome-github-integration.html">Jenkins Declarative Pipeline and Awesome Github Integration</a></li>
<li><a href="../../2016/12/cpp-compiler-benchmark-on-expression-templates-library-etl.html">C++ Compiler benchmark on Expression Templates Library (ETL)</a></li>
<li><a href="../../2015/07/simulate-static_if-with-c11c14.html">Simulate static_if with C++11/C++14</a></li>
<li><a href="../05/cpp-containers-benchmark-vector-list-deque-plf-colony.html">C++ Containers Benchmark: vector/list/deque and plf::colony</a></li>
<li><a href="../../2015/06/continuous-performance-management-with-cpm-for-cpp.html">Continuous Performance Management with CPM for C++</a></li>
<li><a href="../09/cpp11-concurrency-tutorial-futures.html">C++11 Concurrency Tutorial - Part 5: Futures</a></li>
<li class="navbar-block">
<li class="wicht-navbar-right">
<a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
<img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
</li>
<li class="wicht-navbar-right">
<a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
<img src="../../../assets/img/google_plus.png" alt="Follow +BaptisteWicht on Google+"></a>
</li>
</ul>
</div>

</nav>
</div> 
<div class="col-sm-9 col-lg-10">
<div id="content"></div>
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Jenkins Tip: Send notifications on fixed builds in declarative pipeline</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">
Baptiste Wicht
</span></p>
<p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2017-06-07T09:52:57+02:00" itemprop="datePublished" title="2017-06-07 09:52">2017-06-07 09:52</time></a></p>
<p class="commentline">
<a href="jenkins-tip-send-notifications-fixed-builds-declarative-pipeline.html#disqus_thread" data-disqus-identifier="cache/posts/2017/06/jenkins-tip-send-notifications-fixed-builds-declarative-pipeline.html">Comments</a>
</p>
<p class="sourceline"><a href="jenkins-tip-send-notifications-fixed-builds-declarative-pipeline.rst" class="sourcelink">Source</a></p>
</div>
</header><div class="e-content entry-content" itemprop="articleBody text">
<div>
<p>In <a class="reference external" href="https://baptiste-wicht.com/posts/2017/06/jenkins-declarative-pipeline-and-awesome-github-integration.html">my previous post</a>, I presented a few news about Jenkins and about the fact that I switched to declarative pipelines and Github Organization support for my projects.</p>
<p>The main issue I had with this system is that I lost the ability to get
notifications on build that recover. Normally, I would get an email indicating
that build X was back to normal, but I haven't found a way to solve that for
declarative pipeline.</p>
<p>By following a few posts on StackOverflow, I now have the solution and it is the
same problem that was already present in scripted pipelines. Namely, the status
of the current build is not set early enough for the notification. Basically,
you have to set the notification yourself. Here is what a declarative pipeline
looks like:</p>
<pre class="code groovy"><a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-1"></a><span class="n">pipeline</span> <span class="o">{</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-2"></a>    <span class="n">agent</span> <span class="n">any</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-3"></a>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-4"></a>    <span class="n">stages</span> <span class="o">{</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-5"></a>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-6"></a>        <span class="c1">// Normal Stages</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-7"></a>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-8"></a>        <span class="n">stage</span> <span class="o">(</span><span class="s1">'success'</span><span class="o">){</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-9"></a>            <span class="n">steps</span> <span class="o">{</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-10"></a>                <span class="n">script</span> <span class="o">{</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-11"></a>                    <span class="n">currentBuild</span><span class="o">.</span><span class="na">result</span> <span class="o">=</span> <span class="s1">'SUCCESS'</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-12"></a>                <span class="o">}</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-13"></a>            <span class="o">}</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-14"></a>        <span class="o">}</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-15"></a>    <span class="o">}</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-16"></a>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-17"></a>    <span class="n">post</span> <span class="o">{</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-18"></a>        <span class="n">failure</span> <span class="o">{</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-19"></a>            <span class="n">script</span> <span class="o">{</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-20"></a>                <span class="n">currentBuild</span><span class="o">.</span><span class="na">result</span> <span class="o">=</span> <span class="s1">'FAILURE'</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-21"></a>            <span class="o">}</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-22"></a>        <span class="o">}</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-23"></a>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-24"></a>        <span class="n">always</span> <span class="o">{</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-25"></a>            <span class="n">step</span><span class="o">([</span><span class="n">$class</span><span class="o">:</span> <span class="s1">'Mailer'</span><span class="o">,</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-26"></a>                <span class="nl">notifyEveryUnstableBuild:</span> <span class="kc">true</span><span class="o">,</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-27"></a>                <span class="nl">recipients:</span> <span class="s2">"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a9cbc8d9ddc0daddcc87dec0cac1dde9cec4c8c0c587cac6c4">[email&#160;protected]</a>"</span><span class="o">,</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-28"></a>                <span class="nl">sendToIndividuals:</span> <span class="kc">true</span><span class="o">])</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-29"></a>        <span class="o">}</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-30"></a>    <span class="o">}</span>
<a name="rest_code_fa9325ba41204aaf9cce7b65733e1a52-31"></a><span class="o">}</span>
</pre>
<p>There are two important things here. First, a new stage (success) is added that
simply set the result of the current build to SUCCESS once it is done. It must
be the last stage on the pipeline. This could also be added as the last step of
the last stage instead of adding a new stage, but I think it's clearer like
this. The second thing is the failure block in which the result of the current
build is set to FAILURE. With these two things, the Mailer plugin now sends
notification when a build has been fixed.</p>
<p>I hope that will help some of you. I personally think that it should be much
easier than that. All this boilerplate is polluting the pipeline that should be
kept more maintainable, but for now it seems, it's the nicest way to achieve
that, short of handling all conditions in the post block and sending mail
directly there, but that would result in even more boilerplate code.</p>
</div>
</div>
<aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/continuous-integration.html" rel="tag">Continuous Integration</a></li>
<li><a class="tag p-category" href="../../../categories/jenkins.html" rel="tag">Jenkins</a></li>
<li><a class="tag p-category" href="../../../categories/tools.html" rel="tag">Tools</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous">
<a href="jenkins-declarative-pipeline-and-awesome-github-integration.html" rel="prev" title="Jenkins Declarative Pipeline and Awesome Github Integration">Previous post</a>
</li>
<li class="next">
<a href="../07/update-on-deep-learning-library-dll-dropout-batch-normalization-adaptive-learning-rates.html" rel="next" title="Update on Deep Learning Library (DLL): Dropout, Batch Normalization, Adaptive Learning Rates, ...">Next post</a>
</li>
</ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
<div id="disqus_thread"></div>
<script src="/cdn-cgi/scripts/78d64697/cloudflare-static/email-decode.min.js"></script><script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2017/06/jenkins-tip-send-notifications-fixed-builds-declarative-pipeline.html",
        disqus_title="Jenkins Tip: Send notifications on fixed builds in declarative pipeline",
        disqus_identifier="cache/posts/2017/06/jenkins-tip-send-notifications-fixed-builds-declarative-pipeline.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
<a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>
</section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> 
</div>

</div>



<footer>
Contents Â© 2017 <a href="/cdn-cgi/l/email-protection#305251404459434455475953584470575d51595c1e535f5d">Baptiste Wicht</a> - Powered by <a href="http://getnikola.com" rel="nofollow">Nikola</a> - License:
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
<ul class="footer_inline_ul">
<li>
<a href="jenkins-tip-send-notifications-fixed-builds-declarative-pipeline.rst" id="sourcelink">Source</a>
</li>
</ul></footer><script src="/cdn-cgi/scripts/78d64697/cloudflare-static/email-decode.min.js"></script><script src="../../../assets/js/all-nocdn.js"></script>
</body>
</html>
