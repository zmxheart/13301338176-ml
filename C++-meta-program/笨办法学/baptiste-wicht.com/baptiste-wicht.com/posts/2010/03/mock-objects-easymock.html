<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mock objects with EasyMock | Blog blog("Baptiste Wicht");</title>
<script src="/cdn-cgi/apps/head/98vpnawSZZMscPn4oDND-ZgswjM.js"></script><link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/posts/2010/03/mock-objects-easymock.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="welcome-to-my-new-website.html" title="Welcome to my new website !" type="text/html">
<link rel="next" href="bundle-non-osgi-dependencies-maven.html" title="Bundle non-OSGi dependencies with Maven" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="Mock objects with EasyMock">
<meta property="og:url" content="http://baptiste-wicht.com/posts/2010/03/mock-objects-easymock.html">
<meta property="og:description" content="1. Introduction

The mock objects allows to make unit tests on objects depending on other objects. We will replace this dependencies with mock objects. With that, we can by example verify than the met">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2010-03-18T06:53:54+01:00">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Libraries">
<meta property="article:tag" content="Tests">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
<div class="container-fluid">

<div class="row">
<div class="col-sm-3 col-lg-2">
<nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="http://baptiste-wicht.com/">
<span id="blog-title">Blog blog("Baptiste Wicht");</span>
</a>
</div>

<div class="collapse navbar-collapse navbar-ex1-collapse">
<ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
</li>
<li>
<a href="../../../stories/publications.html">Publications</a>
</li>
<li>
<a href="../../../stories/projects.html">Projects</a>
</li>
<li>
<a href="../../../categories/index.html">Tags</a>
</li>
<li>
<a href="../../../archive.html">Archives</a>
</li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>
</li>
<li class="navbar-content">
<h3>Related posts</h3>
</li>
<li><a href="../04/java-7-more-dynamics.html">Java 7 : More dynamics</a></li>
<li><a href="../04/java-7-the-new-java-util-objects-class.html">Java 7 : The new java.util.Objects class</a></li>
<li><a href="../../2009/12/swing-user-interface-jtable.html">Creation of Swing User Interface : Tables (JTable)</a></li>
<li><a href="../02/java-keywords.html">The reserved keywords of the Java Language</a></li>
<li><a href="../05/java-7-add-public-defender-methods-to-java-interfaces.html">Java 7 : Add "public defender methods" to Java interfaces</a></li>
<li><a href="../../2014/07/catch-powerful-yet-simple-cpp-test-framework.html">Catch: A powerful yet simple C++ test framework</a></li>
<li class="navbar-block">
<li class="wicht-navbar-right">
<a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
<img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
</li>
<li class="wicht-navbar-right">
<a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
<img src="../../../assets/img/google_plus.png" alt="Follow +BaptisteWicht on Google+"></a>
</li>
</ul>
</div>

</nav>
</div> 
<div class="col-sm-9 col-lg-10">
<div id="content"></div>
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Mock objects with EasyMock</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">
Baptiste Wicht
</span></p>
<p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2010-03-18T06:53:54+01:00" itemprop="datePublished" title="2010-03-18 06:53">2010-03-18 06:53</time></a></p>
<p class="commentline">
<a href="mock-objects-easymock.html#disqus_thread" data-disqus-identifier="cache/posts/2010/03/mock-objects-easymock.html">Comments</a>
</p>
<p class="sourceline"><a href="mock-objects-easymock.wp" class="sourcelink">Source</a></p>
</div>
</header><div class="e-content entry-content" itemprop="articleBody text">
<div>
<h4>1. Introduction</h4>
<p>The mock objects allows to make unit tests on objects depending on other objects. We will replace this dependencies with mock objects. With that, we can by example verify than the method xyzzy() has been called 5 times and returned 33. That can be practical in a several cases. By exampe, if the object to mock is slow or undeterministic (depending on time, or why not on the weather). This objects are really difficult to test because we can make a lot of tests but we could never find the special cases. Test cases with mock objects enable us to test this cases.</p>

<p>There is several tools to make mock objects. In this article, we will use EasyMock 2.5.2 with JUnit 4.7.</p>
<p>Here is the interface to test :</p>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ISimpleDao</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NotExistingException</span><span class="o">;</span>
    <span class="kt">int</span> <span class="nf">count</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">debug</span><span class="o">();</span>
    <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">insert</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">);</span>
<span class="o">}</span>
</pre>
<p>And here is our class to test :</p>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">ISimpleDao</span> <span class="n">dao</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDao</span><span class="o">(</span><span class="n">ISimpleDao</span> <span class="n">dao</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dao</span> <span class="o">=</span> <span class="n">dao</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">insert</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">dao</span><span class="o">.</span><span class="na">isValid</span><span class="o">(</span><span class="n">title</span><span class="o">)){</span>
            <span class="n">dao</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">String</span><span class="o">...</span> <span class="n">titles</span><span class="o">){</span>
        <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span> <span class="o">:</span> <span class="n">titles</span><span class="o">){</span>
            <span class="n">dao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">remove</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">){</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dao</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">title</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NotExistingException</span> <span class="n">e</span><span class="o">){</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">dao</span><span class="o">.</span><span class="na">count</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">debug</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Debug informations of SimpleService"</span><span class="o">);</span>
        <span class="n">dao</span><span class="o">.</span><span class="na">debug</span><span class="o">();</span>
    <span class="o">}</span>
</pre>
<p>Our mock will implement the ISimpleDao interface and we will give it to SimpleService who's the class to test. This example is really simplistic, but it will be enough to cover the main features of EasyMock.</p>

<h4>2. Verify a behaviour</h4>
<p>Here is the structure i will use in this article :</p>
<pre class="code literal-block"><span></span><span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.easymock.EasyMock.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleServiceTest</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">SimpleService</span> <span class="n">simpleService</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">ISimpleDao</span> <span class="n">simpleDaoMock</span><span class="o">;</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">(){</span>
        <span class="n">simpleService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleService</span><span class="o">();</span>
        <span class="n">simpleService</span><span class="o">.</span><span class="na">setDao</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertValid</span><span class="o">(){}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertNotValid</span><span class="o">(){}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(){}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeWithoutException</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">NotExistingException</span> <span class="o">{}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeWithException</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">NotExistingException</span> <span class="o">{}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">size</span><span class="o">(){}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">debug</span><span class="o">(){}</span>
<span class="o">}</span>
</pre>
<p>First of all, we'll start with create a mock object. For that, we've to use the EasyMock class and its method createMock, with the interface in parameter. To improve code readability, we use a static import like what we do in general with JUnit.</p>
<pre class="code literal-block"><span></span><span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.Assert.*</span><span class="o">;</span>
<span class="kn">import static</span> <span class="nn">org.easymock.EasyMock.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleServiceTest</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">SimpleService</span> <span class="n">simpleService</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">ISimpleDao</span> <span class="n">simpleDaoMock</span><span class="o">;</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">(){</span>
        <span class="n">simpleDaoMock</span> <span class="o">=</span> <span class="n">createMock</span><span class="o">(</span><span class="n">ISimpleDao</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">simpleService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleService</span><span class="o">();</span>
        <span class="n">simpleService</span><span class="o">.</span><span class="na">setDao</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>
<p>This will create a mock objet implementing ISimpleDao interface. The first thing we can do with EasyMock is verify than a method has been called. EasyMock works like a recorder :</p>
<ul>
<li>We play the desired sequence on the mock object.</li>
<li>We record the played sequence.</li>
<li>We test the object</li>
<li>We verify that the test sequence correspond to the recorded one</li>
</ul>
<p>So, we'll test to start that the debug() method of SimpleService call the debug() method of our Dao :</p>
<pre class="code literal-block"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">debug</span><span class="o">(){</span>
    <span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">debug</span><span class="o">();</span>
    <span class="n">replay</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
    <span class="n">simpleService</span><span class="o">.</span><span class="na">debug</span><span class="o">();</span>
    <span class="n">verify</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
<span class="o">}</span>
</pre>
<p>The replay method enable to save the record and the verify method compare the two records are equals. If not equals, the verify method will launch AssertionError. If you launch the written test, it will executes fines, but if we comment the dao.debug() statement in SimpleSerivce, the test will fail :</p>
<pre>java.lang.AssertionError:
  Expectation failure on verify:
    debug(): expected: 1, actual: 0
    at org.easymock.internal.MocksControl.verify(MocksControl.java:111)
    at org.easymock.EasyMock.verify(EasyMock.java:1608)
    at com.dvp.wichtounet.easymock.SimpleServiceTest.debug(SimpleServiceTest.java:45)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
    at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
    at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
    at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
    at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:94)
    at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:165)
    at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:60)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:110)</pre>
<p>So, EasyMock has detected that the method has not bee called and the test fails. If you want to verify that a non-void method has been called , you will have an IllegalStateException because no return behaviour has been specified. We will see that in the next chapter.</p>

<h4>3. Wait for return values</h4>
<p>We will now work with methods returning values. In this case, we've to define a return behaviour. To do that, we must use the expect() method to encapsulate the call and the andReturn() method to specify a return value. Here is how we can test the size() method :</p>
<pre class="code literal-block"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">size</span><span class="o">(){</span>
    <span class="n">expect</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">count</span><span class="o">()).</span><span class="na">andReturn</span><span class="o">(</span><span class="mi">32</span><span class="o">);</span>
    <span class="n">replay</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
    <span class="n">assertEquals</span><span class="o">(</span><span class="mi">32</span><span class="o">,</span> <span class="n">simpleService</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
    <span class="n">verify</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
<span class="o">}</span>
</pre>
<p>With that, we make two tests, we verify that the count method has been called and that size() return the same value as count(). That is the case if we launch the test. We can see that it's really simple to specify a return value for a mocked method.</p>
<h4>4. Work with exceptions</h4>
<p>EasyMock can also work with exceptions. We can use again the expect() method, but this times we will use the andThrow method to specify the throwed exception. Here is what we can do with the remove() method test with and without exception :</p>
<pre class="code literal-block"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeWithoutException</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">NotExistingException</span> <span class="o">{</span>
    <span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s">"Mary"</span><span class="o">);</span>
    <span class="n">replay</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
    <span class="n">assertTrue</span><span class="o">(</span><span class="n">simpleService</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s">"Mary"</span><span class="o">));</span>
    <span class="n">verify</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeWithException</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">NotExistingException</span> <span class="o">{</span>
    <span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s">"Arthur"</span><span class="o">);</span>
    <span class="n">expectLastCall</span><span class="o">().</span><span class="na">andThrow</span><span class="o">(</span><span class="k">new</span> <span class="n">NotExistingException</span><span class="o">());</span>
    <span class="n">replay</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
    <span class="n">assertFalse</span><span class="o">(</span><span class="n">simpleService</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s">"Arthur"</span><span class="o">));</span>
    <span class="n">verify</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
<span class="o">}</span>
</pre>
<p>Once again, only one method call is enough to specify a behaviour. I think it's here that we can see the power of mocks objects.</p>

<h4>5. Miscellaneous</h4>
<h5>5.1. Verify the number of calls</h5>
<p>Now we can test the save() method :</p>
<pre class="code literal-block"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(){</span>
    <span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">"xyzzy"</span><span class="o">);</span>
    <span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">"xyzzy"</span><span class="o">);</span>
    <span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">"xyzzy"</span><span class="o">);</span>
    <span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">"xyzzy"</span><span class="o">);</span>
    <span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">"xyzzy"</span><span class="o">);</span>

    <span class="n">replay</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>

    <span class="n">simpleService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">"xyzzy"</span><span class="o">,</span> <span class="s">"xyzzy"</span><span class="o">,</span> <span class="s">"xyzzy"</span><span class="o">,</span> <span class="s">"xyzzy"</span><span class="o">,</span> <span class="s">"xyzzy"</span><span class="o">);</span>

    <span class="n">verify</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
<span class="o">}</span>
</pre>
<p>This kind of code is really heavy to write with a high number of calls. We have two solutions. We can do a loop for all the calls or use the times() method of EasyMock :</p>
<pre class="code literal-block"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(){</span>
    <span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">"xyzzy"</span><span class="o">);</span>

    <span class="n">expectLastCall</span><span class="o">().</span><span class="na">times</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

    <span class="n">replay</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>

    <span class="n">simpleService</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="s">"xyzzy"</span><span class="o">,</span> <span class="s">"xyzzy"</span><span class="o">,</span> <span class="s">"xyzzy"</span><span class="o">,</span> <span class="s">"xyzzy"</span><span class="o">,</span> <span class="s">"xyzzy"</span><span class="o">);</span>

    <span class="n">verify</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
<span class="o">}</span>
</pre>
<p>A lot clearer, no ? It's also possible to specify that a method must called any times with the anyTimes() method and an interval of times with the times(min,max) method.</p>
<h5>5.2. Verify calls order</h5>
<p>We will now test the insert() method :</p>
<pre class="code literal-block"><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertValid</span><span class="o">(){</span>
    <span class="n">expect</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">isValid</span><span class="o">(</span><span class="s">"Arthur"</span><span class="o">)).</span><span class="na">andReturn</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"Arthur"</span><span class="o">);</span>
    <span class="n">replay</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
    <span class="n">simpleService</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"Arthur"</span><span class="o">);</span>
    <span class="n">verify</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">insertNotValid</span><span class="o">(){</span>
    <span class="n">expect</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">.</span><span class="na">isValid</span><span class="o">(</span><span class="s">"Arthur"</span><span class="o">)).</span><span class="na">andReturn</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
    <span class="n">replay</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
    <span class="n">simpleService</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"Arthur"</span><span class="o">);</span>
    <span class="n">verify</span><span class="o">(</span><span class="n">simpleDaoMock</span><span class="o">);</span>
<span class="o">}</span>
</pre>
<p>You're going to say that we've already seen all that stuff. But in that kind of case, it could be interesting to verify that the calls are in the good order. Indeed, if the method isValid() is called after the insert, that's really useful. With EasyMock, there is two ways to verify calls order. First, you can use the createStrictMock insted of createMock to create your mock or you can use the checkOrder(mock, true) method to specify that the mock is strict. A strict mock is simply a mock who cares about the order of the calls. So we can keep all our tests in the current state and just use one of this two methods and the order will be checked. Of course, we can verify the order only in certain tests methods. That can be done using checkOrder(mock, true) at the start of the test method.</p>
<h5>5.3. Mock a class</h5>
<p>EasyMock has an extension to mock classes and not interfaces. It's EasyMock Class Extesion. All the use is the same, we just have to use this import :</p>
<pre class="code literal-block"><span></span><span class="kn">import static</span> <span class="nn">org.easymock.classextension.EasyMock.*</span><span class="o">;</span>
</pre>
<p>Moreover, we can also make a partial mocking with by example only one method :</p>
<pre class="code literal-block"><span></span><span class="n">Mocked</span> <span class="n">mock</span> <span class="o">=</span> <span class="n">createMockBuilder</span><span class="o">(</span><span class="n">Mocked</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">addMockedMethod</span><span class="o">(</span><span class="s">"mockedMethod"</span><span class="o">).</span><span class="na">createMock</span><span class="o">();</span>
</pre>
<p>Keep in mind that the final classes are not supported and that the final methods are not mocked.</p>

<h4>6. Conclusion</h4>
<p>So, we have seen all the features of EasyMock to create mock objects for unit tests. Like you've seen, it's a really simple but powerful way to verify the behaviour of an object depending on an other. There are others libraries for mock objects like JMock, JMockit or Mockito, but personally, i think EasyMock is most comfortable to use and give all the features i need to make my own unit tests. That's why i choose this library to make this article.</p>
<p>I hope this article has interested you. Don't hesitate to comment it ;)</p>
</div>
</div>
<aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/java.html" rel="tag">Java</a></li>
<li><a class="tag p-category" href="../../../categories/libraries.html" rel="tag">Libraries</a></li>
<li><a class="tag p-category" href="../../../categories/tests.html" rel="tag">Tests</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous">
<a href="welcome-to-my-new-website.html" rel="prev" title="Welcome to my new website !">Previous post</a>
</li>
<li class="next">
<a href="bundle-non-osgi-dependencies-maven.html" rel="next" title="Bundle non-OSGi dependencies with Maven">Next post</a>
</li>
</ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
<div id="disqus_thread"></div>
<script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2010/03/mock-objects-easymock.html",
        disqus_title="Mock objects with EasyMock",
        disqus_identifier="cache/posts/2010/03/mock-objects-easymock.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
<a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>
</section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> 
</div>

</div>



<footer>
Contents © 2017 <a href="/cdn-cgi/l/email-protection#eb898a9b9f82989f8e9c8288839fab8c868a8287c5888486">Baptiste Wicht</a> - Powered by <a href="http://getnikola.com" rel="nofollow">Nikola</a> - License:
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
<ul class="footer_inline_ul">
<li>
<a href="mock-objects-easymock.wp" id="sourcelink">Source</a>
</li>
</ul></footer><script src="/cdn-cgi/scripts/78d64697/cloudflare-static/email-decode.min.js"></script><script src="../../../assets/js/all-nocdn.js"></script>
</body>
</html>
