<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Java Concurrency - Part 7 : Executors and thread pools | Blog blog("Baptiste Wicht");</title>
<script src="/cdn-cgi/apps/head/98vpnawSZZMscPn4oDND-ZgswjM.js"></script><link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/posts/2010/09/java-concurrency-part-7-executors-and-thread-pools.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="hardware-guide-the-power-supply.html" title="Hardware Guide : The power supply" type="text/html">
<link rel="next" href="jtheque-utils-1-1-5.html" title="JTheque Utils 1.1.5" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="Java Concurrency - Part 7 : Executors and thread pools">
<meta property="og:url" content="http://baptiste-wicht.com/posts/2010/09/java-concurrency-part-7-executors-and-thread-pools.html">
<meta property="og:description" content="Let's start with a new post in the Java concurrency series.
This time we'll learn how to start cleanly new threads and to manage thread pools. In Java, if you have a Runnable like this :
Runnable runn">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2010-09-15T07:17:27+02:00">
<meta property="article:tag" content="Concurrency">
<meta property="article:tag" content="Java">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
<div class="container-fluid">

<div class="row">
<div class="col-sm-3 col-lg-2">
<nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="http://baptiste-wicht.com/">
<span id="blog-title">Blog blog("Baptiste Wicht");</span>
</a>
</div>

<div class="collapse navbar-collapse navbar-ex1-collapse">
<ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
</li>
<li>
<a href="../../../stories/publications.html">Publications</a>
</li>
<li>
<a href="../../../stories/projects.html">Projects</a>
</li>
<li>
<a href="../../../categories/index.html">Tags</a>
</li>
<li>
<a href="../../../archive.html">Archives</a>
</li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>
</li>
<li class="navbar-content">
<h3>Related posts</h3>
</li>
<li><a href="../05/java-concurrency-part-1-threads.html">Java Concurrency - Part 1 : Threads</a></li>
<li><a href="../05/java-concurrency-part-2-manipulate-threads.html">Java Concurrency : Part 2 - Manipulate Threads</a></li>
<li><a href="../../2012/03/cpp11-concurrency-part1-start-threads.html">C++11 Concurrency - Part 1 : Start Threads</a></li>
<li><a href="../08/java-concurrrency-synchronization-locks.html">Java Concurrency – Part 3 : Synchronization with intrinsic locks</a></li>
<li><a href="../04/java-7-more-concurrency.html">Java 7 : More concurrency</a></li>
<li><a href="../08/java-concurrency-in-practice-book-review.html">Java Concurrency in Practice - Book Review</a></li>
<li class="navbar-block">
<li class="wicht-navbar-right">
<a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
<img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
</li>
<li class="wicht-navbar-right">
<a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
<img src="../../../assets/img/google_plus.png" alt="Follow +BaptisteWicht on Google+"></a>
</li>
</ul>
</div>

</nav>
</div> 
<div class="col-sm-9 col-lg-10">
<div id="content"></div>
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Java Concurrency - Part 7 : Executors and thread pools</a></h1>
<div class="metadata">
<p class="byline author vcard"><span class="byline-name fn" itemprop="author">
Baptiste Wicht
</span></p>
<p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2010-09-15T07:17:27+02:00" itemprop="datePublished" title="2010-09-15 07:17">2010-09-15 07:17</time></a></p>
<p class="commentline">
<a href="java-concurrency-part-7-executors-and-thread-pools.html#disqus_thread" data-disqus-identifier="cache/posts/2010/09/java-concurrency-part-7-executors-and-thread-pools.html">Comments</a>
</p>
<p class="sourceline"><a href="java-concurrency-part-7-executors-and-thread-pools.wp" class="sourcelink">Source</a></p>
</div>
</header><div class="e-content entry-content" itemprop="articleBody text">
<div>
<p>Let's start with a new post in the Java concurrency series.</p>
<p>This time we'll learn how to start cleanly new threads and to manage thread pools. In Java, if you have a Runnable like this :</p>
<pre class="code literal-block"><span></span><span class="n">Runnable</span> <span class="n">runnable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(){</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Run"</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre>
<p>You can easily run it in a new thread :</p>
<pre class="code literal-block"><span></span><span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">runnable</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>
</pre>
<p>This is very simple and clean, but what if you've several long running tasks that you want to load in parralel and then wait for the completion of all the tasks, it's a little bit harder to code and if you want to get the return value of all the tasks it becomes really difficult to keep a good code. But like for almost any problems, Java has a solution for you, the Executors. This simple class allows you to create thread pools and thread factories.</p>

<p>A thread pool is represented by an instance of the class ExecutorService. With an ExecutorService, you can submit task that will be completed in the future. Here are the type of thread pools you can create with the Executors class :</p>
<ul>
<li>
<strong>Single Thread Executor</strong> : A thread pool with only one thread. So all the submitted task will be executed sequentially. Method : <em>Executors.newSingleThreadExecutor()</em>
</li>
<li>
<strong>Cached Thread Pool</strong> : A thread pool that create as many threads it needs to execute the task in parralel. The old available threads will be reused for the new tasks. If a thread is not used during 60 seconds, it will be terminated and removed from the pool. Method : <em>Executors.newCachedThreadPool()</em>
</li>
<li>
<strong>Fixed Thread Pool</strong> : A thread pool with a fixed number of threads. If a thread is not available for the task, the task is put in queue waiting for an other task to ends. Method : <em>Executors.newFixedThreadPool()</em>
</li>
<li>
<strong>Scheduled Thread Pool</strong> : A thread pool made to schedule future task. Method : <em>Executors.newScheduledThreadPool()</em>
</li>
<li>
<strong>Single Thread Scheduled Pool</strong> : A thread pool with only one thread to schedule future task. Method : <em>Executors.newSingleThreadScheduledExecutor()</em>
</li>
</ul>
<p>Once you have a thread pool, you can submit task to it using the different submit methods. You can submit a Runnable or a Callableto the thread pool. The method return a Future representing the future state of the task. If you submitted a Runnable, the Future object return null once the task finished.</p>
<p>By example, if you have this Callable :</p>
<pre class="code literal-block"><span></span><span class="kd">private</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">StringTask</span> <span class="kd">implements</span> <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
   <span class="kd">public</span> <span class="n">String</span> <span class="nf">call</span><span class="o">(){</span>
      <span class="c1">//Long operations</span>

      <span class="k">return</span> <span class="s">"Run"</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre>
<p>If you want to execute that task 10 times using 4 threads, you can use that code :</p>
<pre class="code literal-block"><span></span><span class="n">ExecutorService</span> <span class="n">pool</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
   <span class="n">pool</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="n">StringTask</span><span class="o">());</span>
<span class="o">}</span>
</pre>
<p>But you must shutdown the thread pool in order to terminate all the threads of the pool :</p>
<pre class="code literal-block"><span></span><span class="n">pool</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</pre>
<p>If you don't do that, the JVM risk to not shutdown because there is still threads not terminated. You can also force the shutdown of the pool using shutdownNow, with that the currently running tasks will be interrupted and the tasks not started will not be started at all.</p>
<p>But with that example, you cannot get the result of the task. So let's get the Future objects of the tasks :</p>
<pre class="code literal-block"><span></span><span class="n">ExecutorService</span> <span class="n">pool</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">futures</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;(</span><span class="mi">10</span><span class="o">);</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
   <span class="n">futures</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">pool</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="n">StringTask</span><span class="o">()));</span>
<span class="o">}</span>

<span class="k">for</span><span class="o">(</span><span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">:</span> <span class="n">futures</span><span class="o">){</span>
   <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>

   <span class="c1">//Compute the result</span>
<span class="o">}</span>

<span class="n">pool</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</pre>
<p>But this code is a bit complicated. And there is a disadvantage. If the first task takes a long time to compute and all the other tasks ends before the first, the current thread cannot compute the result before the first task ends. Once again, Java has the solution for you, CompletionService.</p>
<p>A CompletionService is a service that make easier to wait for result of submitted task to an executor. The implementation is ExecutorCompletionService who's based on an ExecutorService to work. So let's try :</p>
<pre class="code literal-block"><span></span><span class="n">ExecutorService</span> <span class="n">threadPool</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>

<span class="n">CompletionService</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">pool</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExecutorCompletionService</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;(</span><span class="n">threadPool</span><span class="o">);</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
   <span class="n">pool</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="k">new</span> <span class="n">StringTask</span><span class="o">());</span>
<span class="o">}</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
   <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="na">take</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>

   <span class="c1">//Compute the result</span>
<span class="o">}</span>

<span class="n">threadPool</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</pre>
<p>With that, you have the result in the order they are completed and you don't have to keep a collection of Future.</p>
<p>Here we are, you have the tools in hand to launch tasks in parralel using performing thread pools. Using Executors, ExecutorService and CompletionService you can create complex algorithm using several taks. With that tools, it's really easy to change the number of threads performing in parralel or adding more tasks without changing a lot of code.</p>
<p>I hope that this post will help you to write better concurrent code.</p>
</div>
</div>
<aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/concurrency.html" rel="tag">Concurrency</a></li>
<li><a class="tag p-category" href="../../../categories/java.html" rel="tag">Java</a></li>
</ul>
<ul class="pager hidden-print">
<li class="previous">
<a href="hardware-guide-the-power-supply.html" rel="prev" title="Hardware Guide : The power supply">Previous post</a>
</li>
<li class="next">
<a href="jtheque-utils-1-1-5.html" rel="next" title="JTheque Utils 1.1.5">Next post</a>
</li>
</ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
<div id="disqus_thread"></div>
<script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2010/09/java-concurrency-part-7-executors-and-thread-pools.html",
        disqus_title="Java Concurrency - Part 7 : Executors and thread pools",
        disqus_identifier="cache/posts/2010/09/java-concurrency-part-7-executors-and-thread-pools.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
<a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>
</section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> 
</div>

</div>



<footer>
Contents © 2017 <a href="/cdn-cgi/l/email-protection#35575445415c464150425c565d41755258545c591b565a58">Baptiste Wicht</a> - Powered by <a href="http://getnikola.com" rel="nofollow">Nikola</a> - License:
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
<ul class="footer_inline_ul">
<li>
<a href="java-concurrency-part-7-executors-and-thread-pools.wp" id="sourcelink">Source</a>
</li>
</ul></footer><script src="/cdn-cgi/scripts/78d64697/cloudflare-static/email-decode.min.js"></script><script src="../../../assets/js/all-nocdn.js"></script>
</body>
</html>
